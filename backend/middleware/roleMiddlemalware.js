//middleware/roleMiddlemalware.js
const admin = require('firebase-admin');
const { firestore } = require('../config/********');

const isAdmin = (req, res, next) => {
    const userRole = req.userData.role;
    if (userRole === 'admin') {
        next(); // Proceed if the user is an admin
    } else {
        return res.status(403).json({ message: 'Access denied. Admins only.' });
    }
};

const isOwner = async (req, res, next) => {
    const userId = req.userId;
    const { postId } = req.params;

    if (!postId) {
        return res.status(400).json({ message: 'Post ID is required.' });
    }

    const postRef = firestore.collection('posts').doc(postId);
    const postDoc = await postRef.get();

    if (!postDoc.exists) {
        return res.status(404).send('Post not found.');
    }

    const postData = postDoc.data();

    // Check if the logged-in user is the owner of the post
    if (userId === postData.userId) {
        return next(); // Proceed if they are the owner
    } else {
        return res.status(403).json({ message: 'You do not have permission to delete this post.' });
    }
};

module.exports = { isAdmin, isOwner };